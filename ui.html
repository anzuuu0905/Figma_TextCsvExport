<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <h2>Export Text Layers as CSV</h2>
  <button id="downloadButton" style="display: none;">Download CSV</button>
  <p id="message">Waiting for data...</p>

  <script>
    let csvData = "";

    onmessage = (event) => {
      const message = event.data.pluginMessage;
      console.log("Message received from Figma:", message); // デバッグ用のログ

      if (message.type === "error") {
        document.getElementById("message").textContent = message.message;
      } else if (message.type === "csv") {
        csvData = message.data;
        document.getElementById("message").textContent = "Data ready to download!";
        document.getElementById("downloadButton").style.display = "block";
      }
    };

    document.getElementById("downloadButton").addEventListener("click", () => {
      const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", "text_layers.csv");
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  </script>
</body>

</html>
